<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Gia Phả Phan Đức - Chi Hai Phái Nhì</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .node circle { fill: #fff; stroke: #8b0000; stroke-width: 3px; }
        .node text { font: 12px sans-serif; font-weight: bold; }
        .link { fill: none; stroke: #ccc; stroke-width: 2px; }
        #tree-container { width: 100%; height: 800px; border: 1px solid #ddd; background: #fdfdfd; }
    </style>
</head>
<body>
    <h1>Cây Gia Phả Phan Đức (Chi Hai Phái Nhì)</h1>
    <div id="tree-container"></div>

    <script>
        // THAY LINK API CỦA BẠN VÀO ĐÂY
        const SHEET_API = "https://opensheet.elk.sh/1bKYm6Mk9TzqreY-vFSfwBaJ9YxucRaee/giapha1";

        async function drawTree() {
            const response = await fetch(SHEET_API);
            const data = await response.json();

            // Chuyển đổi dữ liệu phẳng sang cấu trúc cây (Parent-Child)
            const stratify = d3.stratify()
                .id(d => d.ID)
                .parentId(d => d.Cha_ID === "0" ? null : d.Cha_ID);

            const root = stratify(data);
            const width = 1000;
            const height = 600;

            const treeLayout = d3.tree().size([width - 200, height - 100]);
            treeLayout(root);

            const svg = d3.select("#tree-container").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(100, 50)");

            // Vẽ đường nối
            svg.selectAll(".link")
                .data(root.links())
                .enter().append("path")
                .attr("class", "link")
                .attr("d", d3.linkVertical().x(d => d.x).y(d => d.y));

            // Vẽ các nút (thành viên)
            const node = svg.selectAll(".node")
                .data(root.descendants())
                .enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.x},${d.y})`);

            node.append("circle").attr("r", 10);
            node.append("text")
                .attr("dy", ".35em")
                .attr("y", d => d.children ? -20 : 20)
                .style("text-anchor", "middle")
                .text(d => d.data.Ho_va_Ten);
        }

        drawTree();
    </script>
</body>
</html>