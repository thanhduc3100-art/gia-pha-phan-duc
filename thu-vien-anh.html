<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Thư Viện Ảnh - Phan Đức</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css">
</head>
<body>

<div class="banner-container">
    <img src="image4.jpg" alt="Nhà thờ họ Phan Đức" class="banner-image">
</div>

<nav class="navbar">
    <a href="index.html">TRANG CHỦ</a>
    <a href="lich-su.html">LỊCH SỬ</a>
    <a href="pha-he.html">PHẢ ĐỒ</a>
    <a href="thu-vien-anh.html" class="active">THƯ VIỆN ẢNH</a>

    <div class="dropdown">
        <button class="dropbtn">THỜ PHỤNG & AN TÁNG ▼</button>
        <div class="dropdown-content">
            <a href="tho-phung.html">NƠI THỜ PHỤNG</a>
            <a href="khu-mo.html">KHU MỘ GIA TỘC</a>
        </div>
    </div>

    <a href="ngay-gio.html">NGÀY GIỖ & KỴ</a>
    <a href="tin-tuc.html">TIN TỨC</a>
    <a href="dong-gop.html">ĐÓNG GÓP</a>
</nav>

<main class="content-section">
    <h1 style="text-align: center; color: var(--red-dark); margin-bottom: 40px;">HÌNH ẢNH HOẠT ĐỘNG</h1>
    <div id="gallery-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px;">
        <p style="text-align: center; grid-column: 1/-1;">Đang tải album ảnh...</p>
    </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>

<script>
    const SHEET_ID = "1H5Gi3MXAD6p9tywPmaiz4awtuETRKtK03cR_-bXeLVU";
    const API_URL = `https://opensheet.elk.sh/${SHEET_ID}/album_anh`;
    const BASE_URL = "https://gia-pha-phan-duc.vercel.app/"; 

   async function loadAlbums() {
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            let html = "";

            data.forEach((album, index) => {
                const folder = album.Thu_Muc;
                const total = parseInt(album.So_Luong);
                const albumTitle = album.Ten_Album;
                const description = album.Gioi_thieu || ""; 
                // LẤY ĐÚNG ẢNH BÌA TỪ CỘT Anh_Bia TRONG SHEETS
                const coverImage = album.Anh_Bia; 

                // Tìm đoạn này trong file HTML của bạn và thay thế:
html += `
    <div class="album-card" id="card-${index}" style="background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
        <h3 style="color: var(--red-dark); margin-bottom: 5px; font-size: 1.1rem;">${albumTitle}</h3>
        <p style="font-size: 0.9rem; color: #555; font-style: italic; margin-bottom: 15px; line-height: 1.4; height: 40px; overflow: hidden;">${description}</p>

        <div class="photo-list" id="list-${index}">
            <a href="${coverImage}" data-lightbox="album-${index}" data-title="${albumTitle}">
                <div class="img-wrapper">
                    <img src="${coverImage}" 
                         onerror="this.parentElement.parentElement.parentElement.parentElement.style.display='none';"
                         style="cursor: pointer;">
                </div>
            </a>
        </div>
        
        <div style="display: flex; justify-content: space-between; margin-top: 10px; align-items: center; border-top: 1px solid #eee; padding-top: 10px;">
            <p style="font-size: 0.8rem; color: #888; margin: 0;">Kho ảnh: ${total} tấm</p>
            <span style="font-size: 0.75rem; color: var(--red-dark); font-weight: bold;">XEM ALBUM ➜</span>
        </div>
    </div>
`;

                // NẠP CÁC ẢNH CÒN LẠI TRONG KHO GitHub (Ẩn đi, chỉ hiện khi mở Lightbox)
                setTimeout(() => {
                    const listContainer = document.getElementById(`list-${index}`);
                    for (let i = 1; i <= total; i++) {
                        const imgUrl = `${BASE_URL}${folder}/a%20(${i}).jpg`;
                        
                        const a = document.createElement('a');
                        a.href = imgUrl;
                        a.setAttribute('data-lightbox', `album-${index}`);
                        a.setAttribute('data-title', `${albumTitle} - ${description}`);
                        a.style.display = "none"; // Ẩn tất cả ảnh con
                        
                        const img = document.createElement('img');
                        img.src = imgUrl;
                        // Nếu ảnh bị xóa trên GitHub, xóa luôn thẻ link để Lightbox không bị trắng trang
                        img.onerror = () => a.remove();
                        
                        a.appendChild(img);
                        listContainer.appendChild(a);
                    }
                }, 100);
            });
            document.getElementById('gallery-container').innerHTML = html;
        } catch (error) {
            console.error("Lỗi:", error);
        }
    }
    // Khởi chạy khi trang web tải xong
    loadAlbums();
</script>

</body>
</html>
